<!DOCTYPE HTML>
<html>
    <head>  
    </head>
    <body>
    <script>
        var socket = new WebSocket("ws://raspberrypi:8888/ws");
        var lastPwrExpMovAvg = null;
        var weightConstant = 0.2;
        
        socket.onopen = function(){  
          console.log("connected"); 
        }; 

        socket.onmessage = function (message) {
          
          if ((message.data).length < 100){
            var SplitMessage = (message.data).split(", ");
            console.log("receiving: " + message.data);
            var time = SplitMessage[0];
            var absorb = SplitMessage[1];
            var depth = SplitMessage[2];
            var pwr = SplitMessage[3];
            if (lastPwrExpMovAvg == null){
              lastPwrExpMovAvg = pwr;
              }
            var pwrExpMovAvg = (weightConstant*pwr + (1 - weightConstant)*lastPwrExpMovAvg).toPrecision(3)
            document.getElementById("timePoint").innerHTML = 'Time: ' + time;
            document.getElementById("absorbPoint").innerHTML = 'Absorbance: ' + absorb;
            document.getElementById("depthPoint").innerHTML = 'Depth: ' + depth;
            document.getElementById("pwrPoint").innerHTML = 'Power: ' + pwr;
            document.getElementById("pwrExpAvg").innerHTML = 'Power Exp Avg: ' + pwrExpMovAvg;
            lastPwrExpMovAvg = pwrExpMovAvg;
            }
          else{
            var powerPlotPlace = document.getElementById('powerPlot');
            var base64Plot = 'data:image/jpg;base64,' + (message.data)
            var image = document.createElement('img');
            image.onload = function() {
                powerPlotPlace.innerHTML = '';
                powerPlotPlace.appendChild(this);
            }
            image.src = base64Plot;
            }    
          };

        socket.onclose = function(){
          console.log("disconnected"); 
        };

        sendMessage = function(message) {
          socket.send(message);
        };

      </script>
    
    <div id=timePoint></div>
    <div id=absorbPoint></div>
    <div id=depthPoint></div>
    <div id=pwrPoint></div>
    <div id=pwrExpAvg></div>

    <div id=powerPlot padding=100px></div>
    </body>
    
</html>
